<!DOCTYPE HTML>
<html>
<head>

    <title>表单详情</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link href="__STATIC__/css/bootstrap/css/bootstrap.css?2024" rel="stylesheet" type="text/css"/>
    <link href="__STATIC__/css/site.css?2024"     rel="stylesheet" type="text/css"/>
    <link href="__STATIC__/css/print/print.css"          rel="stylesheet"  type="text/css" media="print" />
    <link href="__STATIC__/css/print/print-preview.css" rel="stylesheet" type="text/css" media="screen">
    <style>
        #components {
            min-height: 600px;
        }
        #target {
            min-height: 200px;
            border: 1px solid #ccc;
            padding: 5px;
        }
        #target .component {
            border: 1px solid #fff;
        }
        #temp {
            width: 500px;
            background: white;
            border: 1px dotted #ccc;
            border-radius: 10px;
        }
        .popover-content form {
            margin: 0 auto;
            width: 213px;
        }
        .popover-content form .btn {
            margin-right: 10px
        }
        #source {
            min-height: 500px;
        }
        .dropDown{display:inline-block}.dropDown_A{display:inline-block}
        .dropDown-menu{ display:none;transition: all 0.3s ease 0s}
        .dropDown:focus,.dropDown-menu:focus {outline:0}
        .dropDown-menu li.arrow{ position:absolute;display:block; width:12px; height:8px; margin-top:-13px; margin-left:20%; line-height:0;background:url(../images/icon-jt.png) no-repeat 0 0}

        /*鼠标经过	*/
        .dropDown.hover.dropDown_A,.dropDown.open.dropDown_A{text-decoration:none;background-color:rgba(255,255,255,0.2)}
        .dropDown.open.dropDown_A.menu_dropdown-arrow{transition-duration:0.3s ;transition-property:all;_background-position:0 0}
        .dropDown.open.dropDown_A.menu_dropdown-arrow{transform: rotate(180deg)}
        .menu{background-color:#fff;border:solid 1px #f2f2f2; display: inline-block}
        .menu.radius{border-top-left-radius:0;border-top-right-radius:0}
        .menu.box-shadow{border-top:none}
        .menu > li{ position: relative; float: none;display:block}
        .menu > li > a{ display: block;clear: both;border-bottom:solid 1px #f2f2f2;padding:6px 20px;text-align:left;line-height:1.5;font-weight: normal;white-space:nowrap}
        .menu > li:last-child > a{ border-bottom:none}
        .menu > li > a:hover,.menu > li > a:focus,.menu > li.open > a{ text-decoration:none;background-color:#fafafa}
        .menu > li > a.arrow{ position:absolute; top:50%; margin-top:-10px; right:5px;line-height: 20px; height: 20px; color: #999}
        .menu > li >.menu{ display: none}
        .menu > li.open >.menu{ display: inline-block;position: absolute; left:100%;top:-1px;min-width:100%}
        /*禁用菜单*/
        .menu > li.disabled > a{color:#999;text-decoration:none; cursor:no-drop; background-color:transparent}
        /*线条*/
        .menu > li.divider{ display:block;height:0px; line-height:0px;margin:9px 0;overflow:hidden; border-top:solid 1px #eee}
        /*打开菜单*/
        .dropDown >.dropDown-menu{ display: none}
        .dropDown.open{position:relative;z-index:990}
        /*默认左对齐*/
        .dropDown.open >.dropDown-menu{position:absolute;z-index:1000;display:inline-block;top:100%;left:-25px;min-width:100%;background-color:#fff;border:solid 1px #f2f2f2}
        /*右对齐*/
        .dropDown.open.right >.dropDown-menu{right:-1px!important;left:auto!important}
        .span1-4{
            width: auto;
        }
        .span1-5{
            width: 1000px;
        }
        .span1-5 textarea{
            height: 50px;
            width: 980px;
        }
        .span1-6{
            width: 480px;
        }
    </style>
</head>
<body style="width: 1235px">

<div style="text-align: right;margin: 20px 180px 0 40px" class="print-preview">
    <div id="aside" class="grid_3 push_1" style="float: left;margin-left:13px">
    </div>
<button class='btn ' id="tijiao" type='submit'>提交</button>
<span class="dropDown">
        <a class="dropDown_A btn" id="set" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">设置审批人员</a>
    </span>
</div>
<hr>
 <div style="margin:50px 180px 50px 55px;border:2px solid; border-color: #c6bebe" >
    <fieldset>
        {$html}
    </fieldset>
    </div>

<script type="text/javascript" src="__STATIC__/index/lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="__STATIC__/index/lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="__STATIC__/index/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="__STATIC__/index/h-ui.admin/js/H-ui.admin.js"></script>
<script src="__STATIC__/css/print/jquery.tools.min.js"></script>
<script src="__STATIC__/css/print/jquery.print-preview.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
    //刚进入页面就渲染js
    $(document).ready(function () {
        $("[readonly]").removeAttr("readonly");
        $("[shenfen!='{$identity}']").attr("readonly",true);
        $("[shenfen!='{$identity}']:not('.btn')").unbind('click');
    });
       //给input 添加value 属性
       $("input").blur(function () {
           $(this).attr("value", $(this).val());
       });

      $("textarea").blur(function () {
        $(this).text($(this).val());
      });
    $(function() {
        // Add link for print preview and intialise
        $('#aside').prepend('<button class="print-preview btn">打印</button>');
        $('button.print-preview').printPreview();

        // Add keybinding (not recommended for production use)
        $(document).bind('keydown', function(e) {
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 80 && !$('#print-modal').length) {
                $.printPreview.loadPrintPreview();
                return false;
            }
        });
    });
    //学生填完表单做第一次转发
    $('#tijiao').click(function () {

        var contents= $('fieldset').html();
        var formName=$('input[name="form_name"]').val();
        var f_id={$f_id};
        var url="{:url('form/studentSub')}";
        var data={
            'f_id':f_id,
            'html':contents,
            'formName':formName
        };
        $.post(url,data,function (result) {

        });


    });

    //设置审批人员
    $('#set').click(function () {
        var str='';
        var f_id={$f_id};
        $("fieldset").find(".control-group .controls .leipiplugins").each(function (index,data) {
                if ($(this).attr("shenfen")!='user_1') {
                    str += $(this).attr("shenfen") + '/';
                }
        });
        //判断是否已经选择老师
        var url2="{:url('form/judge')}";
        var da2={
          'f_id':f_id
        };
        $.post(url2,da2,function (result) {
            //如果已经选择显示选择了谁
            if (result.status==1){
                var url1="{:url('form/selectTeacher')}";
                var da={
                    'f_id':f_id,
                    'data_po':str,
                };
                $.post(url1,da,function (data) {
                    attrbut(data,'以设置的审批人员');
                });
            }else{

                var url='{:url('form/findTeacher')}';
                var data={
                    'data_po':str,
                    'f_id':f_id,
                };
                $.post(url,data,function (data) {
                    attrbut(data,'请设置审批人员');
                });
            }
        });

        function attrbut(re,title) {
            var title = title;
            var index = layer.open({
                type: 1,
                title: title,
                offset:['10px','400px',],
                content:re,
            });
            layer.style(index, {
                width: '370px',
                height:'550px',
            });
        }
    });

    $('[leipiplugins=qianzi]').click(function () {
        var num= $('[leipiplugins=qianzi]').index(this);

        var url="{:url('form/qianzi')}";
        var data={
            'num':num
        };
        $.post(url,data,function (result) {
            layer.open({
                type: 1,
                title:'签字区域',
                area: ['700px', '450px'],
                fixed: false, //不固定
                maxmin: true,
                content: result
            });
        });

    });

</script>

